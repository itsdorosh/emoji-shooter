<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Emoji Shooter 🔫</title>
	<link rel="stylesheet" href="./main.css">
</head>
<body>
<div id="inGameButtons" class="position-absolute hide">
	<p id="pointsCount">Count: 0</p>
	<button id="pauseButton">Pause ⏸</button>
</div>

<div id="gameButtons" class="position-absolute">
	<h1 id="greetingCaption">Emoji Shooter 🔫</h1>
	<h1 id="gameOverCaption" class="hide">GAME OVER</h1>
	<button id="playButton">Play ▶️</button>
	<button id="restartButton" class="hide">Restart 🔄</button>
</div>

<div id="generalButtons" class="position-absolute">
	<span id="fullscreenMode" onclick="toggleFullScreen()">📺️</span>
	<span id="gamepad" class="hide">🎮</span>
	<span id="mouse" class="hide">🖱</span>
</div>

<div id="canvasContainer"></div>

<script src="https://unpkg.com/three@0.119.1/build/three.js"></script>
<script src="./src/constants.js"></script>
<script src="src/enemies.js"></script>
<script src="./src/controls.js"></script>
<script src="./src/raycaster.js"></script>
<script src="./src/viewer.js"></script>
<script src="./src/engine.js"></script>

<script>
	// containers
	const canvasContainer = document.getElementById('canvasContainer');
	const inGameButtons = document.getElementById('inGameButtons');
	const gameButtons = document.getElementById('gameButtons');

	// buttons
	const playButton = document.getElementById('playButton');
	const pauseButton = document.getElementById('pauseButton');
	const restartButton = document.getElementById('restartButton');
	const gamepadButton = document.getElementById('gamepad');
	const mouseButton = document.getElementById('mouse');

	// captions
	const greetingCaption = document.getElementById('greetingCaption');
	const gameOverCaption = document.getElementById('gameOverCaption');

	const viewer = new Viewer(canvasContainer);
	const controls = new Controls(canvasContainer);
	const raycaster = new Raycaster(viewer.camera);
	const engine = new Engine(viewer, controls, raycaster);

	engine.onPointCountUpdate((count) => {
		document.getElementById('pointsCount').innerText = `Count: ${count}`;
	});

	engine.onGameOver(() => {
		gameButtons.classList.remove('hide');
		greetingCaption.classList.add('hide');
		gameOverCaption.classList.remove('hide');
		playButton.classList.add('hide');
		restartButton.classList.remove('hide');
	});

	playButton.addEventListener('click', () => {
		gameButtons.classList.add('hide');
		inGameButtons.classList.remove('hide');
		engine.play();
	});

	pauseButton.addEventListener('click', () => {
		gameButtons.classList.remove('hide');
		restartButton.classList.remove('hide');
		engine.pause();
	});

	restartButton.addEventListener('click', () => {
		greetingCaption.classList.add('hide');
		gameOverCaption.classList.remove('hide');
		gameButtons.classList.add('hide');
		engine.restart();
	});

	gamepadButton.addEventListener('click', () => controls.switchControlsMode(CONTROLS_MODES.GAMEPAD_MODE));

	mouseButton.addEventListener('click', () => controls.switchControlsMode(CONTROLS_MODES.MOUSE_MODE));

	controls.on('gamepadconnected', () => {
		controls.switchControlsMode(CONTROLS_MODES.MOUSE_MODE);
	});

	controls.on('gamepaddisconnected', () => {
		controls.switchControlsMode(CONTROLS_MODES.NO_MODE);
	});

	controls.on('controlsModeSwitched', (mode) => {
		switch (mode) {
			case CONTROLS_MODES.MOUSE_MODE: {
				mouseButton.classList.add('hide');
				gamepadButton.classList.remove('hide');

				break;
			}

			case CONTROLS_MODES.GAMEPAD_MODE: {
				mouseButton.classList.remove('hide');
				gamepadButton.classList.add('hide');

				break;
			}

			case CONTROLS_MODES.NO_MODE: {
				mouseButton.classList.add('hide');
				gamepadButton.classList.add('hide');

				break;
			}
		}
	});

	function toggleFullScreen() {
		if (!document.fullscreenElement) {
			document.documentElement.requestFullscreen();
		} else {
			if (document.exitFullscreen) {
				document.exitFullscreen();
			}
		}
	}
</script>
</body>
</html>
